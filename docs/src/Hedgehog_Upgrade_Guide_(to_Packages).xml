
<p>&nbsp;</p>
<p>This document describes how to upgrade a server from release 2.1.0 to release 2.1.1 of Hedgehog via packages.&nbsp;</p>
<p>&nbsp;</p>
<p><ac:structured-macro ac:macro-id="84a2de1f-81fa-4598-a6ba-e2a7a9ab554b" ac:name="toc" ac:schema-version="1"><ac:parameter ac:name="style">none</ac:parameter></ac:structured-macro></p>
<p>&nbsp;</p>
<p><strong><span style="line-height: 1.5625;">Back up the old installation</span></strong></p>
<p><span style="line-height: 1.5625;">If desired, back up the existing installation (the directory structure in the User Guide is a useful reference) and database.&nbsp;</span></p>
<h2><span style="line-height: 1.5625;">1. Pre-installation</span></h2>
<h3>1.2 Cron jobs</h3>
<p>Stop refile and grok cron job running:</p><ac:structured-macro ac:macro-id="08a576ef-79c7-41f7-aa6b-ac1e1d695865" ac:name="code" ac:schema-version="1"><ac:plain-text-body><![CDATA[sudo -u hedgegho crontab -e
# Import XML data every 15 mins
00,15,30,45 * * * * <prefix>/bin/refile_and_grok.sh -c >> /var/log/hedgehog/refile_and_grok_xml_to_db.sh.log 2>&1]]></ac:plain-text-body></ac:structured-macro>
<p>Comment out any other jobs that are about to run. If the dsc-extractor process is running wait for it to finish before continuing.</p>
<h3>1.3 Disable web front end</h3>
<p>It is recommended to disable the web front end during upgrade e.g by enabling a holding page.</p>
<p>&nbsp;</p><ac:structured-macro ac:macro-id="f05d9ecc-d0b2-41af-bfe5-8ffb598a7395" ac:name="info" ac:schema-version="1"><ac:rich-text-body>
<p><strong>Source install vs Package install:</strong></p>
<ul>
<li><span>If 2.1.0 was installed from source, perform steps 2 and 4.&nbsp;</span></li>
<li>If 2.1.0 was installed from packages, perform steps 3 and 4.</li></ul></ac:rich-text-body></ac:structured-macro>
<h2>2. Installation of packages</h2>
<h3>2.1 Install packages</h3>
<ul>
<li>Refer to section 2.1 of the 'Hedgehog Installation Guide' to install the required packages.&nbsp;</li></ul>
<h3>2.3 Cater for different directory structure</h3>
<p>Installing from a package places some files in a different directory structure compared to installing from code.</p>
<ul>
<li><strong>Data</strong>&nbsp;- if it is desired to retain existing data (XML files, cached plots and RSSAC reports) then the existing&nbsp;<em>&lt;prefix&gt;/var/hedgehog</em>&nbsp;directory should be copied or linked (e.g. symbolically or via re-mounting) to the new location shown below
<ul>
<li>If this is not required then simply run the&nbsp;<em>/usr/bin/hedgehogctl database_update_nodes</em>&nbsp;script again to create the directory structure for upload of XML data in the new location AFTER completing step 2.1<br />&nbsp;</li></ul></li></ul>
<ul>
<li><strong>Tools and scripts - </strong>those&nbsp;installed via source under&nbsp;<em>&lt;prefix&gt;</em>&nbsp;in&nbsp;<em>bin</em>&nbsp;and&nbsp;<em>libexec/hedgehog</em>&nbsp;are installed by the packages under&nbsp;<em>/usr/</em>&nbsp;as shown below. Update any cron jobs or scripts accordingly.&nbsp;</li></ul>
<p>&nbsp;</p>
<table>
<tbody>
<tr>
<th>Source location</th>
<th>Package location</th>
<th colspan="1">Contents</th></tr>
<tr>
<td>&lt;prefix&gt;/etc/hedgehog/</td>
<td>/etc/hedgehog/</td>
<td colspan="1">Hedgehog configuration files (yaml and nodes)</td></tr>
<tr>
<td colspan="1">&lt;prefix&gt;/etc/hedgehog/*.sample</td>
<td colspan="1">/usr/share/doc/hedgehog/examples/*.sample</td>
<td colspan="1">Sample Hedgehog configuration files</td></tr>
<tr>
<td>&lt;prefix&gt;/var/hedgehog/</td>
<td>/var/lib/hedgehog/</td>
<td colspan="1">
<p>'data' directory containing XML data</p>
<p>'www' directory containing cached plots and rssac reports</p></td></tr>
<tr>
<td colspan="1">&lt;prefix&gt;/bin/hedgehogctl</td>
<td colspan="1">/usr/bin/hedgehogctl</td>
<td colspan="1">Wrapper script for Hedgehog tools</td></tr>
<tr>
<td colspan="1">&lt;prefix&gt;/bin/refile_and_grok</td>
<td colspan="1">/usr/bin/refile_and_grok</td>
<td colspan="1">refile_and_grok script</td></tr>
<tr>
<td colspan="1">&lt;prefix&gt;/libexec/hedgehog/</td>
<td colspan="1">/usr/lib/hedgehog/</td>
<td colspan="1">Hedgehog tools scripts and DDL updates</td></tr></tbody></table>
<h2>3. Upgrade of Packages</h2><ac:structured-macro ac:macro-id="4b63d758-f1de-456d-adf6-7a76caeca497" ac:name="code" ac:schema-version="1"><ac:plain-text-body><![CDATA[sudo apt-get update
sudo apt-get upgrade]]></ac:plain-text-body></ac:structured-macro>
<h2>4. Post-install</h2>
<h3>4.1 Test web front end</h3>
<p>Re-enable and test the web front end. Make sure to restart apache.</p><ac:structured-macro ac:macro-id="add1086e-e973-4e29-b437-dfbd969e203a" ac:name="code" ac:schema-version="1"><ac:parameter ac:name="language">bash</ac:parameter><ac:plain-text-body><![CDATA[sudo service apache2 reload]]></ac:plain-text-body></ac:structured-macro>
<h3>4.2 Re-enable cron jobs&nbsp;</h3><ac:structured-macro ac:macro-id="29fa3a11-7cb7-447f-8242-11ab26f5bd1e" ac:name="warning" ac:schema-version="1"><ac:rich-text-body>
<p>Remember to use the new script locations when re-enabling the cron jobs when upgrading from source.</p></ac:rich-text-body></ac:structured-macro>
<p>&nbsp;</p>
<p>Restart refile and grok cron job running:</p><ac:structured-macro ac:macro-id="f6849b42-4b08-4fe5-81ed-86ee9f4f597c" ac:name="code" ac:schema-version="1"><ac:plain-text-body><![CDATA[sudo -u hedgehog crontab -e
# Import XML data every 15 mins
00,15,30,45 * * * * /usr/bin/refile_and_grok -c >> /var/log/hedgehog/refile_and_grok_xml_to_db.log 2>&1]]></ac:plain-text-body></ac:structured-macro>
<p>Re-enable any other jobs that were disabled for the upgrade.&nbsp;</p>
<p>&nbsp;</p>